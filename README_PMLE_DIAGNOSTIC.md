# Google Professional Machine Learning Engineer Diagnostic Questions Upserter

This repository contains scripts to upsert Google Professional Machine Learning Engineer (PMLE) diagnostic questions into the Supabase database for use in the Testero diagnostic tool.

## Overview

The `upsert_google_ml_engineer_diagnostic.py` script takes the JSON file generated by the diagnostic question generator and inserts the questions into the Supabase database. The script handles:

- Creating or retrieving the exam record
- Creating or retrieving the exam version
- Creating or retrieving sections based on question topics
- Upserting questions with their options and explanations

## Prerequisites

- Python 3.8+
- Supabase project with the appropriate tables set up
- Environment variables for Supabase connection

## Setup

1. Ensure you have the required Python packages installed:

```bash
pip install supabase
```

2. Set up the required environment variables:

```bash
export SUPABASE_URL="your-supabase-url"
export SUPABASE_SERVICE_KEY="your-supabase-service-key"
```

3. Make sure your Supabase database has the following tables:
   - `exams`
   - `exam_versions`
   - `sections`
   - `questions`
   - `options`
   - `explanations`

4. Ensure the `questions` table has a unique constraint on `(exam_version_id, source_id)` for the upsert operation to work correctly.

## Running the Script

1. Place your diagnostic questions JSON file in the `output` directory. The default path is `output/google_ml_engineer_diagnostic_20250527_215900.json`.

2. Run the script:

```bash
cd /path/to/project
python ../python-api/scripts/upsert_google_ml_engineer_diagnostic.py
```

## Expected Output

The script will log its progress, including:

- Creating or retrieving the exam
- Creating or retrieving the exam version
- Creating or retrieving sections for each topic
- Upserting questions, options, and explanations

A successful run will end with the message "Script finished successfully."

## Troubleshooting

If you encounter issues:

1. **Database Connection Issues**:
   - Verify your environment variables are set correctly
   - Check that your Supabase service key has the necessary permissions

2. **Missing Tables or Columns**:
   - Ensure your database schema matches the expected structure
   - Check for any migration scripts that need to be run

3. **Constraint Errors**:
   - Verify that the `questions` table has a unique constraint on `(exam_version_id, source_id)`

4. **JSON Format Issues**:
   - Ensure your JSON file follows the expected format with questions, options, and explanations

## Customization

If you need to modify the script for a different exam:

1. Update the configuration constants at the top of the script:
   - `EXAM_CODE`
   - `EXAM_NAME`
   - `EXAM_PROVIDER`

2. Adjust the JSON file path in the `main()` function if needed.

## Contributing

To contribute to this project:

1. Make your changes in a feature branch
2. Test thoroughly
3. Submit a pull request with a clear description of your changes
